<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø­Ø±Ø± Ø§Ù„ÙØ­Ø§Ù… Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…ÙŠØ§Øª</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f9f9f9;
      margin: 0; padding: 15px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      box-sizing: border-box;
      min-height: 100vh;
    }
    h2 {
      text-align: center;
      color: #0b2545;
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: 700;
      margin-bottom: 6px;
      color: #0b2545;
    }
    input[type="text"], input[type="url"], input[type="file"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    #thumbnailPreview {
      max-width: 200px;
      margin-bottom: 20px;
      border-radius: 8px;
      display: none;
      box-shadow: 0 0 8px rgba(11, 37, 69, 0.3);
      cursor: pointer;
      object-fit: contain;
      max-height: 150px;
    }

    #toolbar {
      background: #0b2545;
      border-radius: 6px;
      padding: 6px 10px;
      margin-bottom: 20px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ù…Ø­Ø±Ø± */
      display: flex;
      gap: 6px;
      justify-content: center;
      flex-wrap: nowrap;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    #toolbar button, #toolbar select {
      background: white;
      border: none;
      border-radius: 4px;
      padding: 5px 9px;
      cursor: pointer;
      font-size: 13px;
      min-width: 30px;
      text-align: center;
      user-select: none;
      transition: background 0.3s;
      flex-shrink: 0;
    }
    #toolbar button:hover, #toolbar select:hover {
      background: #ddd;
    }
    #toolbar button.active {
      background: #ffce00;
    }

    #editor {
      width: 100%;
      min-height: 400px;
      background: white;
      border-radius: 6px;
      padding: 15px;
      overflow-y: auto;
      outline: none;
      box-sizing: border-box;
      border: 1px solid #ccc;
      font-size: 16px;
      line-height: 1.6;
      color: #0b2545;
      word-break: break-word;
    }

    #editor img,
    #editor video,
    #editor iframe {
      max-width: 100% !important;
      height: auto !important;
      border-radius: 8px;
      display: block;
      margin: 10px auto;
    }

    #htmlInput {
      width: 100%;
      min-height: 200px;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      margin-top: 15px;
      display: none;
      resize: vertical;
    }
    #publishBtn {
      background: #0b2545;
      color: white;
      padding: 14px 20px;
      font-size: 18px;
      width: 100%;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 25px;
      transition: background 0.3s;
    }
    #publishBtn:hover {
      background: #163a78;
    }
    #posts {
      margin-top: 30px;
    }
    .post {
      background: white;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 0 6px rgb(0 0 0 / 0.1);
      position: relative;
      color: #0b2545;
    }
    .post h4 {
      margin: 0 0 10px 0;
      font-size: 20px;
      cursor: pointer;
    }
    .post .actions {
      position: absolute;
      top: 12px;
      left: 12px;
      display: flex;
      gap: 8px;
    }
    .post button {
      background: #d32f2f;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    .post button.edit-btn {
      background: #1976d2;
    }
    .post button:hover {
      opacity: 0.8;
    }
    @media (max-width: 600px) {
      #toolbar {
        overflow-x: auto;
      }
      #thumbnailPreview {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>

  <h2>Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´Ø§Ø±ÙƒØ©</h2>

  <label for="title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:</label>
  <input type="text" id="title" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù‡Ù†Ø§..." />

  <label for="imageUrl">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (Ù…ØµØºØ±Ø©):</label>
  <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg" />
  
  <label for="imageFile">Ø£Ùˆ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ:</label>
  <input type="file" id="imageFile" accept="image/*" />

  <img id="thumbnailPreview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ø±Øª" title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø©" />

  <div id="toolbar" aria-label="Ø´Ø±ÙŠØ· Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­Ø±ÙŠØ±">
    <button type="button" onclick="execCmd('selectAll')" title="ØªØ­Ø¯ÙŠØ¯ ÙƒÙ„ Ø§Ù„Ù†Øµ">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
    <button type="button" onclick="execCmd('bold')" title="Ø¹Ø±ÙŠØ¶ (Ctrl+B)"><b>B</b></button>
    <button type="button" onclick="execCmd('italic')" title="Ù…Ø§Ø¦Ù„ (Ctrl+I)"><i>I</i></button>
    <button type="button" onclick="execCmd('underline')" title="ØªØ³Ø·ÙŠØ± (Ctrl+U)"><u>U</u></button>

    <select id="fontSizeSelector" onchange="execCmdWithValue('fontSize', this.value)" title="Ø­Ø¬Ù… Ø§Ù„Ø®Ø·">
      <option value="">Ø­Ø¬Ù… Ø§Ù„Ø®Ø·</option>
      <option value="1">ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹</option>
      <option value="2">ØµØºÙŠØ±</option>
      <option value="3" selected>Ù…ØªÙˆØ³Ø·</option>
      <option value="4">ÙƒØ¨ÙŠØ±</option>
      <option value="5">Ø£ÙƒØ¨Ø±</option>
      <option value="6">Ø¶Ø®Ù…</option>
      <option value="7">Ø¶Ø®Ù… Ø¬Ø¯Ø§Ù‹</option>
    </select>

    <button type="button" onclick="execCmd('justifyRight')" title="Ù…Ø­Ø§Ø°Ø§Ø© ÙŠÙ…ÙŠÙ†">ÙŠÙ…ÙŠÙ†</button>
    <button type="button" onclick="execCmd('justifyCenter')" title="Ù…Ø­Ø§Ø°Ø§Ø© ÙˆØ³Ø·">ÙˆØ³Ø·</button>
    <button type="button" onclick="execCmd('justifyLeft')" title="Ù…Ø­Ø§Ø°Ø§Ø© ÙŠØ³Ø§Ø±">ÙŠØ³Ø§Ø±</button>

    <button type="button" onclick="insertImageFromDevice()" title="Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ">ğŸ“¤ğŸ–¼ï¸</button>
    <button type="button" onclick="insertImage()" title="Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ù…Ù† Ø±Ø§Ø¨Ø·">ğŸ–¼ï¸</button>
    <button type="button" onclick="insertLinkImage()" title="Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ù…Ø¹ Ø±Ø§Ø¨Ø·">ğŸ”—ğŸ–¼ï¸</button>
    <button type="button" onclick="insertYoutube()" title="Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨">â–¶ï¸</button>
    <button type="button" onclick="toggleHtml()" title="ØªØ¹Ø¯ÙŠÙ„ ÙƒÙˆØ¯ HTML Ø®Ø§Ù…">HTML</button>
  </div>

  <div id="editor" contenteditable="true" spellcheck="true" aria-label="Ù…Ø­Ø±Ø± Ø§Ù„Ù†Øµ"></div>
  <textarea id="htmlInput" aria-label="ÙƒÙˆØ¯ HTML Ù„Ù„Ù…Ø­Ø±Ø±"></textarea>

  <button id="publishBtn">Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</button>

  <div id="posts" aria-live="polite"></div>

  <input type="file" id="hiddenImageInput" accept="image/*" style="display:none;" />

<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCcXWs8SCvzUmLaqdxBe6rTGaRPqvz7BBc",
    authDomain: "alfaham-info.firebaseapp.com",
    databaseURL: "https://alfaham-info-default-rtdb.firebaseio.com/",
    projectId: "alfaham-info",
    storageBucket: "alfaham-info.appspot.com",
    messagingSenderId: "383796585349",
    appId: "1:383796585349:web:c3346dcd6fcfecf733daec"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
  const titleInput = document.getElementById("title");
  const imageUrlInput = document.getElementById("imageUrl");
  const imageFileInput = document.getElementById("imageFile");
  const thumbnailPreview = document.getElementById("thumbnailPreview");
  const editor = document.getElementById("editor");
  const htmlInput = document.getElementById("htmlInput");
  const publishBtn = document.getElementById("publishBtn");
  const fontSizeSelector = document.getElementById("fontSizeSelector");
  const hiddenImageInput = document.getElementById("hiddenImageInput");

  let htmlMode = false;
  let editingId = null;

  // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ø±Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø±Ø§Ø¨Ø·Ù‡Ø§
  imageUrlInput.addEventListener("input", () => {
    const url = imageUrlInput.value.trim();
    if(url) {
      thumbnailPreview.src = url;
      thumbnailPreview.style.display = "block";
      imageFileInput.value = ""; // Ø§Ù…Ø³Ø­ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù Ù„Ùˆ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯
    } else {
      if(!imageFileInput.value) {
        thumbnailPreview.style.display = "none";
        thumbnailPreview.src = "";
      }
    }
  });

  // Ø±ÙØ¹ ØµÙˆØ±Ø© ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ¹Ø±Ø¶Ù‡Ø§
  imageFileInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if(file) {
      const reader = new FileReader();
      reader.onload = function(evt) {
        thumbnailPreview.src = evt.target.result;
        thumbnailPreview.style.display = "block";
        imageUrlInput.value = ""; // Ù…Ø³Ø­ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù„Ùˆ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯
      };
      reader.readAsDataURL(file);
    } else {
      if(!imageUrlInput.value) {
        thumbnailPreview.style.display = "none";
        thumbnailPreview.src = "";
      }
    }
  });

  // Ø¥Ø²Ø§Ù„Ø© ØµÙˆØ±Ø© ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡Ø§
  thumbnailPreview.addEventListener("click", () => {
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© ØµÙˆØ±Ø© ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©ØŸ")) {
      thumbnailPreview.style.display = "none";
      thumbnailPreview.src = "";
      imageUrlInput.value = "";
      imageFileInput.value = "";
    }
  });

  // Ø¯ÙˆØ§Ù„ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª:

  // ØªÙ†ÙÙŠØ° Ø£ÙˆØ§Ù…Ø± Ù…Ø­Ø±Ø± Ø§Ù„Ù†Øµ
  function execCmd(command) {
    if (htmlMode) return alert("Ø¹Ù„ÙŠÙƒ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹");
    document.execCommand(command, false, null);
    syncFontSizeSelector();
  }
  function execCmdWithValue(command, value) {
    if (htmlMode) return alert("Ø¹Ù„ÙŠÙƒ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹");
    if(value) document.execCommand(command, false, value);
    syncFontSizeSelector();
  }

  // Ù…Ø²Ø§Ù…Ù†Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù…Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  function syncFontSizeSelector(){
    let size = document.queryCommandValue("fontSize");
    if(size){
      fontSizeSelector.value = size;
    } else {
      fontSizeSelector.value = "";
    }
  }

  // Ø¥Ø¯Ø±Ø§Ø¬ ØµÙˆØ±Ø© Ù…Ù† Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø·Ù„Ø¨ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©
  function insertImage(){
    if(htmlMode) return alert("Ø¹Ù„ÙŠÙƒ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹");
    const url = prompt("Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©:");
    if(url){
      const width = prompt("Ø£Ø¯Ø®Ù„ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ (Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„):");
      const height = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ (Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ):");
      let imgTag = `<img src="${url}" alt="ØµÙˆØ±Ø©" style="max-width:100%;${width?'width:'+width+'px;':''}${height?'height:'+height+'px;':''}">`;
      insertHtmlAtCursor(imgTag);
    }
  }

  // Ø¥Ø¯Ø±Ø§Ø¬ ØµÙˆØ±Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¶ØºØ· ØªÙØªØ­ Ø±Ø§Ø¨Ø· + Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©
  function insertLinkImage(){
    if(htmlMode) return alert("Ø¹Ù„ÙŠÙƒ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹");
    const url = prompt("Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©:");
    if(!url) return;
    const link = prompt("Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø±Ø§Ø¨Ø· (Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ Ø³ÙŠÙØªØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©):");
    if(!link) return;
    const width = prompt("Ø£Ø¯Ø®Ù„ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ (Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„):");
    const height = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ (Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ):");
    let imgTag = `<a href="${link}" target="_blank"><img src="${url}" alt="ØµÙˆØ±Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø±" style="max-width:100%;${width?'width:'+width+'px;':''}${height?'height:'+height+'px;':''}"></a>`;
    insertHtmlAtCursor(imgTag);
  }

  // Ø¥Ø¯Ø±Ø§Ø¬ ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
  function insertYoutube(){
    if(htmlMode) return alert("Ø¹Ù„ÙŠÙƒ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹");
    const url = prompt("Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨:");
    if(url){
      const videoId = extractYoutubeID(url);
      if(videoId){
        const width = prompt("Ø£Ø¯Ø®Ù„ Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ (Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„):");
        const height = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ (Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ):");
        let style = 'max-width:100%;border-radius:8px;';
        if(width) style += `width:${width}px;`;
        if(height) style += `height:${height}px;`;
        const iframe = `<iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen style="${style}"></iframe>`;
        insertHtmlAtCursor(iframe);
      } else {
        alert("Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­.");
      }
    }
  }

  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ID ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
  function extractYoutubeID(url) {
    const regex = /(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([\w-]{11})/;
    const match = url.match(regex);
    return match ? match[1] : null;
  }

  // Ø¥Ø¯Ø±Ø§Ø¬ ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
  function insertImageFromDevice(){
    if(htmlMode) return alert("Ø¹Ù„ÙŠÙƒ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹");
    hiddenImageInput.click();
  }
  hiddenImageInput.addEventListener("change", () => {
    const file = hiddenImageInput.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      // Ù†Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¨Ø¹Ø¯ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©
      const width = prompt("Ø£Ø¯Ø®Ù„ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ (Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„):");
      const height = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ (Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ):");
      let imgTag = `<img src="${e.target.result}" alt="ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø©" style="max-width:100%;${width?'width:'+width+'px;':''}${height?'height:'+height+'px;':''}">`;
      insertHtmlAtCursor(imgTag);
      hiddenImageInput.value = ""; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† input
    };
    reader.readAsDataURL(file);
  });

  // Ø¥Ø¯Ø±Ø§Ø¬ HTML ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
  function insertHtmlAtCursor(html) {
    let sel, range;
    if(window.getSelection){
      sel = window.getSelection();
      if(sel.getRangeAt && sel.rangeCount){
        range = sel.getRangeAt(0);
        range.deleteContents();
        let el = document.createElement("div");
        el.innerHTML = html;
        let frag = document.createDocumentFragment(), node, lastNode;
        while((node = el.firstChild)){
          lastNode = frag.appendChild(node);
        }
        range.insertNode(frag);
        if(lastNode){
          range = range.cloneRange();
          range.setStartAfter(lastNode);
          range.collapse(true);
          sel.removeAllRanges();
          sel.addRange(range);
        }
      }
    }
    syncFontSizeSelector();
  }

  // ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ùˆ Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ
  function toggleHtml(){
    if(htmlMode){
      // Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø±Ø±
      editor.innerHTML = htmlInput.value;
      htmlInput.style.display = "none";
      editor.style.display = "block";
      publishBtn.disabled = false;
      htmlMode = false;
    } else {
      // Ù…Ù† Ø§Ù„Ù…Ø­Ø±Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯
      htmlInput.value = editor.innerHTML;
      htmlInput.style.display = "block";
      editor.style.display = "none";
      publishBtn.disabled = true;
      htmlMode = true;
    }
  }

  // Ø²Ø± Ø§Ù„Ù†Ø´Ø±/Ø§Ù„ØªØ­Ø¯ÙŠØ«
  publishBtn.addEventListener("click", () => {
    const title = titleInput.value.trim();
    const content = editor.innerHTML.trim();
    let imageUrl = imageUrlInput.value.trim();

    // Ø¥Ø°Ø§ Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØµÙˆØ±Ø© ÙƒØ§Ø±Øª Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¨Ø¯Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·
    if(!imageUrl && thumbnailPreview.style.display === "block" && imageFileInput.files.length > 0){
      // Ù†Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø© Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Base64 ÙÙ‚Ø· (Ù†Ø¸Ø§Ù… ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø§Ø´Ø±)
      imageUrl = thumbnailPreview.src;
    }

    if(!title) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©.");
    if(!content) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©.");

    if(editingId){
      db.ref("articles/" + editingId).set({ title, imageUrl, content })
        .then(() => {
          alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­.");
          resetForm();
          loadPosts();
        })
        .catch(err => alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: " + err.message));
    } else {
      const newKey = db.ref("articles").push().key;
      db.ref("articles/" + newKey).set({ title, imageUrl, content })
        .then(() => {
          alert("ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­.");
          resetForm();
          loadPosts();
        })
        .catch(err => alert("Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: " + err.message));
    }
  });

  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  function resetForm() {
    editingId = null;
    titleInput.value = "";
    imageUrlInput.value = "";
    imageFileInput.value = "";
    thumbnailPreview.style.display = "none";
    thumbnailPreview.src = "";
    editor.innerHTML = "";
    htmlInput.value = "";
    publishBtn.textContent = "Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©";
    fontSizeSelector.value = "3";
    if(htmlMode) toggleHtml();
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù
  const postsContainer = document.getElementById("posts");

  function loadPosts() {
    postsContainer.innerHTML = "Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª...";
    db.ref("articles").once("value").then(snapshot => {
      const data = snapshot.val();
      postsContainer.innerHTML = "";
      if(!data) {
        postsContainer.innerHTML = "<p style='text-align:center;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
        return;
      }

      Object.entries(data).reverse().forEach(([id, article]) => {
        const postDiv = document.createElement("div");
        postDiv.className = "post";
        postDiv.innerHTML = `
          <h4 title="Ø§Ø¶ØºØ· Ù„Ù„ØªØ¹Ø¯ÙŠÙ„">${article.title}</h4>
          <div class="actions">
            <button class="edit-btn">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="delete-btn">ğŸ—‘ Ø­Ø°Ù</button>
          </div>
        `;
        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„
        postDiv.querySelector(".edit-btn").addEventListener("click", () => {
          editingId = id;
          titleInput.value = article.title || "";
          imageUrlInput.value = article.imageUrl || "";
          if(article.imageUrl){
            thumbnailPreview.src = article.imageUrl;
            thumbnailPreview.style.display = "block";
          } else {
            thumbnailPreview.style.display = "none";
            thumbnailPreview.src = "";
          }
          if(htmlMode){
            toggleHtml();
          }
          editor.innerHTML = article.content || "";
          publishBtn.textContent = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©";
          fontSizeSelector.value = "3"; // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
          window.scrollTo({top:0, behavior:"smooth"});
        });
        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø­Ø°Ù
        postDiv.querySelector(".delete-btn").addEventListener("click", () => {
          if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©ØŸ")){
            db.ref("articles/" + id).remove()
              .then(() => {
                if(editingId === id) resetForm();
                loadPosts();
              })
              .catch(err => alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: " + err.message));
          }
        });

        postsContainer.appendChild(postDiv);
      });
    });
  }

  // Ù…Ø²Ø§Ù…Ù†Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù…Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ØªØ­Ø¯ÙŠØ¯ Ù†Øµ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø±
  editor.addEventListener("keyup", syncFontSizeSelector);
  editor.addEventListener("mouseup", syncFontSizeSelector);
  editor.addEventListener("focus", syncFontSizeSelector);

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
  loadPosts();
</script>

</body>
</html>
