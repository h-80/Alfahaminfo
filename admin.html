<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„ÙØ­Ø§Ù… Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…ÙŠØ§Øª</title>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    background: #f9f9f9;
    margin: 0; padding: 20px;
    color: #0b2545;
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  label {
    font-weight: 600;
    margin-bottom: 5px;
    display: block;
  }
  input[type="text"] {
    width: 100%;
    padding: 8px 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
  }
  .toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 8px;
    background: #fff;
    border: 1px solid #ccc;
    padding: 6px 8px;
    border-radius: 6px;
    justify-content: center;
  }
  .toolbar button {
    border: none;
    background: none;
    cursor: pointer;
    font-size: 20px;
    padding: 6px 10px;
    border-radius: 4px;
    transition: background 0.2s;
    color: #0b2545;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .toolbar button:hover {
    background: #0b2545;
    color: #fff;
  }
  #editor {
    min-height: 300px;
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #ccc;
    background: #fff;
    padding: 12px;
    border-radius: 6px;
    font-size: 16px;
    outline: none;
  }
  button#publishBtn {
    margin-top: 15px;
    width: 100%;
    background-color: #0b2545;
    color: white;
    font-size: 18px;
    padding: 12px 0;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s;
  }
  button#publishBtn:hover {
    background-color: #132e6f;
  }
  #posts {
    margin-top: 30px;
  }
  .post {
    background: #fff;
    padding: 12px 15px;
    margin-bottom: 12px;
    border-radius: 6px;
    border: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 16px;
  }
  .post .buttons button {
    background: #0b2545;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 6px 12px;
    cursor: pointer;
    margin-left: 8px;
    font-size: 14px;
    transition: background-color 0.3s;
  }
  .post .buttons button:hover {
    background: #132e6f;
  }
  @media (max-width: 480px) {
    .toolbar {
      gap: 5px;
    }
    .toolbar button {
      font-size: 18px;
      padding: 6px 8px;
    }
    #editor {
      min-height: 250px;
    }
  }
</style>
</head>
<body>

<h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„ÙØ­Ø§Ù… Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…ÙŠØ§Øª</h2>

<label for="title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:</label>
<input type="text" id="title" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©" />

<label for="imageUrl">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ø±Øª (Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø©):</label>
<input type="text" id="imageUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø©" />

<div class="toolbar" aria-label="Ø´Ø±ÙŠØ· Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­Ø±ÙŠØ±">
  <button type="button" title="Ø¹Ø±ÙŠØ¶ (Ctrl+B)" onclick="execCmd('bold')"><b>ğ</b></button>
  <button type="button" title="Ù…Ø§Ø¦Ù„ (Ctrl+I)" onclick="execCmd('italic')"><i>ğ‘°</i></button>
  <button type="button" title="ØªØ³Ø·ÙŠØ± (Ctrl+U)" onclick="execCmd('underline')"><u>UÌ²</u></button>

  <button type="button" title="Ù„ÙˆÙ† Ø§Ù„Ù†Øµ" onclick="setColor()">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>
  </button>

  <button type="button" title="ØªÙƒØ¨ÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø·" onclick="changeFontSize(1)">A+</button>
  <button type="button" title="ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø·" onclick="changeFontSize(-1)">Aâˆ’</button>

  <button type="button" title="Ù…Ø­Ø§Ø°Ø§Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†" onclick="execCmd('justifyRight')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="21" y1="10" x2="3" y2="10"/>
      <line x1="21" y1="6" x2="3" y2="6"/>
      <line x1="21" y1="14" x2="3" y2="14"/>
      <line x1="21" y1="18" x2="3" y2="18"/>
    </svg>
  </button>
  <button type="button" title="Ù…Ø­Ø§Ø°Ø§Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ³Ø·" onclick="execCmd('justifyCenter')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="16" y1="10" x2="8" y2="10"/>
      <line x1="16" y1="6" x2="8" y2="6"/>
      <line x1="16" y1="14" x2="8" y2="14"/>
      <line x1="16" y1="18" x2="8" y2="18"/>
    </svg>
  </button>
  <button type="button" title="Ù…Ø­Ø§Ø°Ø§Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±" onclick="execCmd('justifyLeft')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="3" y1="10" x2="21" y2="10"/>
      <line x1="3" y1="6" x2="21" y2="6"/>
      <line x1="3" y1="14" x2="21" y2="14"/>
      <line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
  </button>

  <button type="button" title="Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©" onclick="insertImage()">ğŸ–¼ï¸</button>
  <button type="button" title="Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨" onclick="insertVideo()">â–¶ï¸</button>

  <button type="button" title="ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„" onclick="selectAllContent()">â˜‘ï¸</button>
  <button type="button" title="Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰" onclick="clearEditor()">ğŸ—‘ï¸</button>
</div>

<div id="editor" contenteditable="true" spellcheck="false" aria-label="Ù…Ø­Ø±Ø± Ø§Ù„Ù†Øµ"></div>

<button id="publishBtn">Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</button>

<h2>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</h2>
<div id="posts"></div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCcXWs8SCvzUmLaqdxBe6rTGaRPqvz7BBc",
    authDomain: "alfaham-info.firebaseapp.com",
    databaseURL: "https://alfaham-info-default-rtdb.firebaseio.com/",
    projectId: "alfaham-info",
    storageBucket: "alfaham-info.appspot.com",
    messagingSenderId: "383796585349",
    appId: "1:383796585349:web:c3346dcd6fcfecf733daec"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ØªÙ†ÙÙŠØ° Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø­Ø±Ø±
  function execCmd(command, value = null) {
    document.execCommand(command, false, value);
    document.getElementById('editor').focus();
  }

  // ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
  function changeFontSize(direction) {
    // direction = 1 (ØªÙƒØ¨ÙŠØ±) -1 (ØªØµØºÙŠØ±)
    const editor = document.getElementById('editor');
    const selection = window.getSelection();
    if (!selection.rangeCount) return;

    let range = selection.getRangeAt(0);
    if (range.collapsed) return; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ¯

    // Ø¥Ù†Ø´Ø§Ø¡ span Ø¨Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯
    let span = document.createElement('span');

    // Ø§Ù‚Ø±Ø£ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø¥Ù† ÙˆØ¬Ø¯)
    let currentSize = window.getComputedStyle(range.startContainer.parentElement).fontSize;
    let currentPx = parseInt(currentSize);

    let newSize = currentPx + (direction * 2);
    if (newSize < 10) newSize = 10;
    if (newSize > 72) newSize = 72;

    span.style.fontSize = newSize + 'px';

    // Ù„Ù Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨Ø§Ù„span
    range.surroundContents(span);
  }

  // ØªØ¹ÙŠÙŠÙ† Ù„ÙˆÙ† Ø§Ù„Ù†Øµ
  function setColor() {
    const color = prompt('Ø§Ø®ØªØ± Ù„ÙˆÙ† Ø§Ù„Ù†Øµ (Ø§Ø³Ù… Ø§Ù„Ù„ÙˆÙ† Ø£Ùˆ ÙƒÙˆØ¯ Hex Ù…Ø«Ù„ #ff0000):', '#000000');
    if (color) execCmd('foreColor', color);
  }

  // Ø¥Ø¯Ø±Ø§Ø¬ ØµÙˆØ±Ø©
  function insertImage() {
    const url = prompt('Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©');
    if (url) execCmd('insertImage', url);
  }

  // Ø¥Ø¯Ø±Ø§Ø¬ ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨ (iframe)
  function insertVideo() {
    const url = prompt('Ø¶Ø¹ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨ (Ù…Ø«Ù„Ø§Ù‹ https://www.youtube.com/watch?v=xxxxx)');
    if (!url) return;

    let videoID = null;
    try {
      const urlObj = new URL(url);
      if (urlObj.hostname.includes('youtube.com')) {
        videoID = urlObj.searchParams.get('v');
      } else if (urlObj.hostname.includes('youtu.be')) {
        videoID = urlObj.pathname.slice(1);
      }
    } catch {
      alert('Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­');
      return;
    }

    if (!videoID) {
      alert('Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ ØºÙŠØ± ØµØ­ÙŠØ­');
      return;
    }

    const iframeHTML = `<iframe width="100%" height="250" src="https://www.youtube.com/embed/${videoID}" frameborder="0" allowfullscreen></iframe>`;
    document.execCommand('insertHTML', false, iframeHTML);
  }

  // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
  function clearEditor() {
    document.getElementById('editor').innerHTML = '';
  }

  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
  function selectAllContent() {
    const editor = document.getElementById('editor');
    const range = document.createRange();
    range.selectNodeContents(editor);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
    editor.focus();
  }

  // Ø§Ù„Ù†Ø´Ø±
  document.getElementById('publishBtn').addEventListener('click', () => {
    const title = document.getElementById('title').value.trim();
    const imageUrl = document.getElementById('imageUrl').value.trim();
    const content = document.getElementById('editor').innerHTML.trim();

    if (!title || !content) {
      alert('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©');
      return;
    }

    const newPostKey = db.ref().child('articles').push().key;

    db.ref('articles/' + newPostKey).set({
      title,
      imageUrl,
      content
    }).then(() => {
      alert('âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­');
      location.reload();
    }).catch(error => {
      alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±: ' + error.message);
    });
  });

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª
  function loadPosts() {
    db.ref('articles').on('value', snapshot => {
      const data = snapshot.val();
      const postsDiv = document.getElementById('posts');
      postsDiv.innerHTML = '';
      if (!data) {
        postsDiv.innerHTML = '<p style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
        return;
      }
      for (const id in data) {
        const post = data[id];
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
          <span>${post.title}</span>
          <div class="buttons">
            <button onclick="editPost('${id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
            <button onclick="deletePost('${id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
          </div>
        `;
        postsDiv.appendChild(div);
      }
    });
  }

  // Ø­Ø°Ù Ù…Ø´Ø§Ø±ÙƒØ©
  function deletePost(id) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©ØŸ')) {
      db.ref('articles/' + id).remove();
    }
  }

  // ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´Ø§Ø±ÙƒØ©
  function editPost(id) {
    db.ref('articles/' + id).once('value').then(snapshot => {
      const data = snapshot.val();
      document.getElementById('title').value = data.title;
      document.getElementById('imageUrl').value = data.imageUrl;
      document.getElementById('editor').innerHTML = data.content;

      document.getElementById('publishBtn').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©';
      document.getElementById('publishBtn').onclick = function () {
        const title = document.getElementById('title').value.trim();
        const imageUrl = document.getElementById('imageUrl').value.trim();
        const content = document.getElementById('editor').innerHTML.trim();

        if (!title || !content) {
          alert('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©');
          return;
        }

        db.ref('articles/' + id).update({ title, imageUrl, content }).then(() => {
          alert('âœï¸ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©');
          location.reload();
        });
      };
    });
  }

  loadPosts();
</script>

</body>
</html>
