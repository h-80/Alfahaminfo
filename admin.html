<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>لوحة التحكم - الفحام للمعلوميات</title>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    background: #f9f9f9;
    margin: 0; padding: 20px;
    color: #0b2545;
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  label {
    font-weight: 600;
    margin-bottom: 5px;
    display: block;
  }
  input[type="text"] {
    width: 100%;
    padding: 8px 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
  }
  .toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 8px;
    background: #fff;
    border: 1px solid #ccc;
    padding: 6px 8px;
    border-radius: 6px;
    justify-content: center;
  }
  .toolbar button {
    border: none;
    background: none;
    cursor: pointer;
    font-size: 20px;
    padding: 6px 10px;
    border-radius: 4px;
    transition: background 0.2s;
    color: #0b2545;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .toolbar button:hover {
    background: #0b2545;
    color: #fff;
  }
  #editor {
    min-height: 300px;
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #ccc;
    background: #fff;
    padding: 12px;
    border-radius: 6px;
    font-size: 16px;
    outline: none;
  }
  button#publishBtn {
    margin-top: 15px;
    width: 100%;
    background-color: #0b2545;
    color: white;
    font-size: 18px;
    padding: 12px 0;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s;
  }
  button#publishBtn:hover {
    background-color: #132e6f;
  }
  #posts {
    margin-top: 30px;
  }
  .post {
    background: #fff;
    padding: 12px 15px;
    margin-bottom: 12px;
    border-radius: 6px;
    border: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 16px;
  }
  .post .buttons button {
    background: #0b2545;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 6px 12px;
    cursor: pointer;
    margin-left: 8px;
    font-size: 14px;
    transition: background-color 0.3s;
  }
  .post .buttons button:hover {
    background: #132e6f;
  }
  @media (max-width: 480px) {
    .toolbar {
      gap: 5px;
    }
    .toolbar button {
      font-size: 18px;
      padding: 6px 8px;
    }
    #editor {
      min-height: 250px;
    }
  }
</style>
</head>
<body>

<h2>لوحة التحكم - الفحام للمعلوميات</h2>

<label for="title">عنوان المشاركة:</label>
<input type="text" id="title" placeholder="اكتب عنوان المشاركة" />

<label for="imageUrl">رابط صورة الكارت (الصورة المصغرة):</label>
<input type="text" id="imageUrl" placeholder="رابط الصورة المصغرة" />

<div class="toolbar" aria-label="شريط أدوات التحرير">
  <button type="button" title="عريض (Ctrl+B)" onclick="execCmd('bold')"><b>𝐁</b></button>
  <button type="button" title="مائل (Ctrl+I)" onclick="execCmd('italic')"><i>𝑰</i></button>
  <button type="button" title="تسطير (Ctrl+U)" onclick="execCmd('underline')"><u>U̲</u></button>

  <button type="button" title="لون النص" onclick="setColor()">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>
  </button>

  <button type="button" title="تكبير حجم الخط" onclick="changeFontSize(1)">A+</button>
  <button type="button" title="تصغير حجم الخط" onclick="changeFontSize(-1)">A−</button>

  <button type="button" title="محاذاة إلى اليمين" onclick="execCmd('justifyRight')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="21" y1="10" x2="3" y2="10"/>
      <line x1="21" y1="6" x2="3" y2="6"/>
      <line x1="21" y1="14" x2="3" y2="14"/>
      <line x1="21" y1="18" x2="3" y2="18"/>
    </svg>
  </button>
  <button type="button" title="محاذاة إلى الوسط" onclick="execCmd('justifyCenter')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="16" y1="10" x2="8" y2="10"/>
      <line x1="16" y1="6" x2="8" y2="6"/>
      <line x1="16" y1="14" x2="8" y2="14"/>
      <line x1="16" y1="18" x2="8" y2="18"/>
    </svg>
  </button>
  <button type="button" title="محاذاة إلى اليسار" onclick="execCmd('justifyLeft')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="3" y1="10" x2="21" y2="10"/>
      <line x1="3" y1="6" x2="21" y2="6"/>
      <line x1="3" y1="14" x2="21" y2="14"/>
      <line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
  </button>

  <button type="button" title="إضافة صورة" onclick="insertImage()">🖼️</button>
  <button type="button" title="إضافة فيديو يوتيوب" onclick="insertVideo()">▶️</button>

  <button type="button" title="تحديد الكل" onclick="selectAllContent()">☑️</button>
  <button type="button" title="مسح المحتوى" onclick="clearEditor()">🗑️</button>
</div>

<div id="editor" contenteditable="true" spellcheck="false" aria-label="محرر النص"></div>

<button id="publishBtn">نشر المشاركة</button>

<h2>جميع المشاركات</h2>
<div id="posts"></div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCcXWs8SCvzUmLaqdxBe6rTGaRPqvz7BBc",
    authDomain: "alfaham-info.firebaseapp.com",
    databaseURL: "https://alfaham-info-default-rtdb.firebaseio.com/",
    projectId: "alfaham-info",
    storageBucket: "alfaham-info.appspot.com",
    messagingSenderId: "383796585349",
    appId: "1:383796585349:web:c3346dcd6fcfecf733daec"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // تنفيذ أوامر المحرر
  function execCmd(command, value = null) {
    document.execCommand(command, false, value);
    document.getElementById('editor').focus();
  }

  // تغيير حجم الخط ديناميكياً
  function changeFontSize(direction) {
    // direction = 1 (تكبير) -1 (تصغير)
    const editor = document.getElementById('editor');
    const selection = window.getSelection();
    if (!selection.rangeCount) return;

    let range = selection.getRangeAt(0);
    if (range.collapsed) return; // لا يوجد تحديد

    // إنشاء span بحجم الخط الجديد
    let span = document.createElement('span');

    // اقرأ حجم الخط الحالي (إن وجد)
    let currentSize = window.getComputedStyle(range.startContainer.parentElement).fontSize;
    let currentPx = parseInt(currentSize);

    let newSize = currentPx + (direction * 2);
    if (newSize < 10) newSize = 10;
    if (newSize > 72) newSize = 72;

    span.style.fontSize = newSize + 'px';

    // لف النص المحدد بالspan
    range.surroundContents(span);
  }

  // تعيين لون النص
  function setColor() {
    const color = prompt('اختر لون النص (اسم اللون أو كود Hex مثل #ff0000):', '#000000');
    if (color) execCmd('foreColor', color);
  }

  // إدراج صورة
  function insertImage() {
    const url = prompt('ضع رابط الصورة');
    if (url) execCmd('insertImage', url);
  }

  // إدراج فيديو يوتيوب (iframe)
  function insertVideo() {
    const url = prompt('ضع رابط فيديو يوتيوب (مثلاً https://www.youtube.com/watch?v=xxxxx)');
    if (!url) return;

    let videoID = null;
    try {
      const urlObj = new URL(url);
      if (urlObj.hostname.includes('youtube.com')) {
        videoID = urlObj.searchParams.get('v');
      } else if (urlObj.hostname.includes('youtu.be')) {
        videoID = urlObj.pathname.slice(1);
      }
    } catch {
      alert('رابط غير صحيح');
      return;
    }

    if (!videoID) {
      alert('رابط يوتيوب غير صحيح');
      return;
    }

    const iframeHTML = `<iframe width="100%" height="250" src="https://www.youtube.com/embed/${videoID}" frameborder="0" allowfullscreen></iframe>`;
    document.execCommand('insertHTML', false, iframeHTML);
  }

  // مسح المحتوى
  function clearEditor() {
    document.getElementById('editor').innerHTML = '';
  }

  // تحديد الكل
  function selectAllContent() {
    const editor = document.getElementById('editor');
    const range = document.createRange();
    range.selectNodeContents(editor);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
    editor.focus();
  }

  // النشر
  document.getElementById('publishBtn').addEventListener('click', () => {
    const title = document.getElementById('title').value.trim();
    const imageUrl = document.getElementById('imageUrl').value.trim();
    const content = document.getElementById('editor').innerHTML.trim();

    if (!title || !content) {
      alert('يرجى كتابة عنوان ومحتوى المشاركة');
      return;
    }

    const newPostKey = db.ref().child('articles').push().key;

    db.ref('articles/' + newPostKey).set({
      title,
      imageUrl,
      content
    }).then(() => {
      alert('✅ تم نشر المشاركة بنجاح');
      location.reload();
    }).catch(error => {
      alert('❌ حدث خطأ أثناء النشر: ' + error.message);
    });
  });

  // تحميل المشاركات
  function loadPosts() {
    db.ref('articles').on('value', snapshot => {
      const data = snapshot.val();
      const postsDiv = document.getElementById('posts');
      postsDiv.innerHTML = '';
      if (!data) {
        postsDiv.innerHTML = '<p style="text-align:center;">لا توجد مشاركات حالياً.</p>';
        return;
      }
      for (const id in data) {
        const post = data[id];
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
          <span>${post.title}</span>
          <div class="buttons">
            <button onclick="editPost('${id}')">✏️ تعديل</button>
            <button onclick="deletePost('${id}')">🗑️ حذف</button>
          </div>
        `;
        postsDiv.appendChild(div);
      }
    });
  }

  // حذف مشاركة
  function deletePost(id) {
    if (confirm('هل أنت متأكد من حذف هذه المشاركة؟')) {
      db.ref('articles/' + id).remove();
    }
  }

  // تعديل مشاركة
  function editPost(id) {
    db.ref('articles/' + id).once('value').then(snapshot => {
      const data = snapshot.val();
      document.getElementById('title').value = data.title;
      document.getElementById('imageUrl').value = data.imageUrl;
      document.getElementById('editor').innerHTML = data.content;

      document.getElementById('publishBtn').textContent = 'تعديل المشاركة';
      document.getElementById('publishBtn').onclick = function () {
        const title = document.getElementById('title').value.trim();
        const imageUrl = document.getElementById('imageUrl').value.trim();
        const content = document.getElementById('editor').innerHTML.trim();

        if (!title || !content) {
          alert('يرجى كتابة عنوان ومحتوى المشاركة');
          return;
        }

        db.ref('articles/' + id).update({ title, imageUrl, content }).then(() => {
          alert('✏️ تم تعديل المشاركة');
          location.reload();
        });
      };
    });
  }

  loadPosts();
</script>

</body>
</html>
